import math

# ================================
# ΔΕΔΟΜΕΝΑ ΚΥΚΛΩΜΑΤΟΣ ΑΣΚΗΣΗΣ 1
# ================================
VCC  = 10.0       # τροφοδοσία (Volt)
R1   = 10e3       # διαιρέτης βάσης επάνω (Ohm)
R2   = 2.7e3      # διαιρέτης βάσης κάτω (Ohm)
RC   = 3.6e3      # αντίσταση συλλέκτη (Ohm)
RE_dc = 1000 + 68 # συνολικό RE στο DC (Ohm)
RE_ac_unbyp = 68  # το κομμάτι του RE που ΔΕΝ είναι bypass στο AC (Ohm)
RL   = 1e3        # φορτίο στην έξοδο (Ohm)
R6   = 1e3        # αντίσταση εισόδου από τη γεννήτρια (Ohm)
beta = 300.0      # β του τρανζίστορ
VBE  = 0.7        # πτώση βάσης-εκπομπού (Volt)
Vg_pp = 0.1       # πλάτος σήματος γεννήτριας σε Vp-p (100 mVp-p)

# ========================
# DC ΑΝΑΛΥΣΗ (ΘΕVENIN)
# (οι πυκνωτές = ανοικτό κύκλωμα)
# ========================

# Ισοδύναμο Thévenin του διαιρέτη βάσης
Rth = (R1 * R2) / (R1 + R2)
Vth = VCC * (R2 / (R1 + R2))

# Ρεύμα βάσης (προσέγγιση 1ης τάξης)
IB = (Vth - VBE) / (Rth + (beta + 1) * RE_dc)

# Ρεύματα
IC = beta * IB
IE = (beta + 1) * IB

# Τάσεις πόλωσης
VE = IE * RE_dc
VB = VE + VBE
VC = VCC - IC * RC

# ========================
# AC ΑΝΑΛΥΣΗ (ΜΙΚΡΟΣΗΜΑ)
# (οι πυκνωτές σύζευξης ≈ βραχυκύκλωμα)
# ========================

# 1. Μικρομοντέλο εκπομπού
re = 0.025 / IE                  # re ≈ 25mV / IE(Α)
re_total = re + RE_ac_unbyp      # re' = re + μη-bypass μέρος RE

# 2. Ισοδύναμο RC || RL
RC_eq = (RC * RL) / (RC + RL)

# 3. Κέρδος τάσης
Av = -RC_eq / re_total

# 4. Αντίσταση εισόδου
Zin_base = beta * re_total       # Zin στο εσωτερικό (βάση → γη)
Zin_stage = 1 / (1/R1 + 1/R2 + 1/Zin_base)  # R1 || R2 || Zin_base

# 5. Σχέση Vg → Vin (διαιρέτης με R6)
Vin_pp = Zin_stage / (Zin_stage + R6) * Vg_pp

# 6. Έξοδος
Vout_pp = Av * Vin_pp

# ========================
# ASCII ΚΥΚΛΩΜΑΤΑ
# ========================

dc_equiv = r"""
========================================
 DC Ισοδύναμο (πυκνωτές = ανοικτό κύκλωμα)
========================================

         VCC = 10V
          +
          |
          |
         .-.
         | |  R1 = 10k
         | |
         '-'
          |
          o-------> προς υπόλοιπο VCC (RC κτλ.)
          |
         .-.
         | |  R2 = 2.7k
         | |
         '-'
          |
         GND

        ΒΑΣΗ (DC)

                 Vth
                  +
                  |
      Vth ----/\/\/\/\-----o----> Β
              Rth          |
                           |
                        |‾‾‾‾‾‾‾|
                        |  BJT   |
                        |________|
                           |
                         R_E(dc) = 1068Ω
                           |
                          GND

 Σημείωση:
 - C1, C2, C3 θεωρούνται ανοικτό κύκλωμα στο DC.
"""

ac_gain_equiv = r"""
========================================
 AC μικρομοντέλο για ΚΕΡΔΟΣ Av
 (Thévenin + re + RC||RL)
========================================

                 (προς έξοδο συλλέκτη)

           RC = 3.6k          RL = 1k
      Vout o--/\/\/\----+----/\/\/\----o
                        |
                        |
                       ( )
                       ( )  RC_eq = RC || RL
                       ( )
                        |
                        o  κόμβος συλλέκτη (C)
                        |
                        |   (μικρομοντέλο)
                       |‾‾‾‾‾‾‾|
                       |  BJT   |
                       |________|
                        |
                        o  κόμβος εκπομπού (E)
                        |
                      re_total = re + 68Ω
                        |
                       GND_ac

  Είσοδος (στη βάση):

        (R1 || R2 || Zin_base) = Zin_stage

  Av ≈ - RC_eq / re_total
"""

ac_zin_equiv = r"""
========================================
 AC μικρομοντέλο για Z_in
 (γεννήτρια + C1 + R6 + θεvenin)
========================================

          R1 = 10k                 R2 = 2.7k
VCC_ac→ GND_ac      (στο AC οι πηγές DC γίνονται γη)

          R1
VCC o---/\/\/\---+
                 |
                 +----o----> κόμβος βάσης B
                 |    |
                 |   / \  Z_in(base) = β(re+68Ω)
                 |   \ /
                 |    |
          R2     |    |
GND o---/\/\/\---+   GND_ac

 Οπότε:

   Z_in(stage) = R1 || R2 || Z_in(base)


 Γεννήτρια εισόδου:

   Vg~ ---(~)--- C1 ---/\/\/\---o----> B
                            R6       (κόμβος βάσης)

 - Ο C1 στο AC θεωρείται βραχυκύκλωμα.
 - Το σήμα "βλέπει" σειρά: R6 → κόμβος B → Zin_stage προς γη.
 - Άρα:
      V_in = Vg * [Zin_stage / (Zin_stage + R6)]
"""

# ========================
# ΕΜΦΑΝΙΣΗ ΑΠΟΤΕΛΕΣΜΑΤΩΝ
# ========================

print("=== DC Ανάλυση ===")
print(f"Rth = {Rth/1e3:.2f} kΩ")
print(f"Vth = {Vth:.2f} V")

print(f"IB  = {IB*1e6:.2f} μA")
print(f"IC  = {IC*1e3:.2f} mA")
print(f"IE  = {IE*1e3:.2f} mA")

print(f"VB  = {VB:.2f} V")
print(f"VE  = {VE:.2f} V")
print(f"VC  = {VC:.2f} V")

print("\n=== AC Ανάλυση ===")
print(f"re        = {re:.2f} Ω")
print(f"re_total  = {re_total:.2f} Ω  (re + 68Ω)")
print(f"RC_eq     = {RC_eq:.2f} Ω  (RC || RL)")
print(f"Av(th)    ≈ {Av:.2f}")

print(f"Zin_base  ≈ {Zin_base/1e3:.2f} kΩ")
print(f"Zin_stage ≈ {Zin_stage/1e3:.2f} kΩ")

print(f"Vin_pp    ≈ {Vin_pp*1e3:.2f} mVp-p")
print(f"Vout_pp   ≈ {Vout_pp*1e3:.2f} mVp-p")

print(dc_equiv)
print(ac_gain_equiv)
print(ac_zin_equiv)
